{"version":3,"sources":["../../src/users/users.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport * as crypto from 'crypto';\nimport { PrismaService } from '../prisma/prisma.service';\nimport { NotificationsService } from '../notifications/notifications.service';\nimport { User, Prisma } from '@prisma/client';\n\n@Injectable()\nexport class UsersService {\n  constructor(\n    private prisma: PrismaService,\n    private notificationsService: NotificationsService,\n  ) {}\n\n  async findOne(email: string): Promise<User | null> {\n    const user = await this.prisma.user.findUnique({\n      where: { email },\n      include: {\n        assignedByTeacher: { select: { name: true } },\n        parentOf: {\n          include: {\n            student: {\n              select: {\n                id: true,\n                name: true,\n                email: true,\n                grade: true,\n                medal: true,\n                profileSlug: true,\n              },\n            },\n          },\n        },\n        studentOf: {\n          include: {\n            parent: {\n              select: {\n                id: true,\n                name: true,\n                email: true,\n              },\n            },\n          },\n        },\n        parentRequests: {\n          orderBy: { createdAt: 'desc' },\n        },\n      },\n    });\n\n    if (user && (!user.profileSlug || !user.profileSettings)) {\n      const updateData: any = {};\n      if (!user.profileSlug) updateData.profileSlug = crypto.randomUUID();\n      if (!user.profileSettings) {\n        updateData.profileSettings = {\n          showMedals: true,\n          showGrades: true,\n          showCourses: true,\n          showTestResults: true,\n        };\n      }\n      return this.prisma.user.update({\n        where: { id: user.id },\n        data: updateData,\n        include: {\n          assignedByTeacher: { select: { name: true } },\n          parentOf: {\n            include: {\n              student: {\n                select: {\n                  id: true,\n                  name: true,\n                  email: true,\n                  grade: true,\n                  medal: true,\n                  profileSlug: true,\n                },\n              },\n            },\n          },\n          studentOf: {\n            include: {\n              parent: {\n                select: {\n                  id: true,\n                  name: true,\n                  email: true,\n                },\n              },\n            },\n          },\n          parentRequests: {\n            orderBy: { createdAt: 'desc' },\n          },\n        },\n      });\n    }\n    return user;\n  }\n\n  async findById(id: string): Promise<User | null> {\n    const user = await this.prisma.user.findUnique({\n      where: { id },\n      include: {\n        assignedByTeacher: { select: { name: true } },\n        parentOf: {\n          include: {\n            student: {\n              select: {\n                id: true,\n                name: true,\n                email: true,\n                grade: true,\n                medal: true,\n                profileSlug: true,\n              },\n            },\n          },\n        },\n        parentRequests: {\n          orderBy: { createdAt: 'desc' },\n        },\n        studentOf: {\n          include: {\n            parent: {\n              select: {\n                id: true,\n                name: true,\n                email: true,\n              },\n            },\n          },\n        },\n        enrollments: {\n          include: {\n            course: {\n              select: { id: true, title: true, thumbnail: true },\n            },\n          },\n        },\n        practiceTestResults: {\n          include: {\n            test: { select: { id: true, title: true } },\n          },\n          orderBy: { createdAt: 'desc' },\n        },\n      },\n    });\n\n    if (user && !user.profileSlug) {\n      return this.prisma.user.update({\n        where: { id: user.id },\n        data: { profileSlug: crypto.randomUUID() },\n        include: {\n          assignedByTeacher: { select: { name: true } },\n          parentOf: {\n            include: {\n              student: {\n                select: {\n                  id: true,\n                  name: true,\n                  email: true,\n                  grade: true,\n                  medal: true,\n                  profileSlug: true,\n                },\n              },\n            },\n          },\n          studentOf: {\n            include: {\n              parent: {\n                select: {\n                  id: true,\n                  name: true,\n                  email: true,\n                },\n              },\n            },\n          },\n          parentRequests: {\n            orderBy: { createdAt: 'desc' },\n          },\n          enrollments: {\n            include: {\n              course: {\n                select: { id: true, title: true, thumbnail: true },\n              },\n            },\n          },\n          practiceTestResults: {\n            include: {\n              test: { select: { id: true, title: true } },\n            },\n            orderBy: { createdAt: 'desc' },\n          },\n        },\n      });\n    }\n    return user;\n  }\n\n  async findAllStudents() {\n    return await this.prisma.user.findMany({\n      where: { role: 'STUDENT' },\n      select: {\n        id: true,\n        name: true,\n        email: true,\n        medal: true,\n        grade: true,\n        academicAssignedAt: true,\n        assignedByTeacher: { select: { name: true } },\n        _count: {\n          select: {\n            enrollments: true,\n            practiceTestResults: true,\n          },\n        },\n      },\n      orderBy: { createdAt: 'desc' },\n    });\n  }\n\n  async updateAcademicStatus(\n    studentId: string,\n    teacherId: string,\n    data: { medal?: any; grade?: any },\n  ) {\n    return await this.prisma.user.update({\n      where: { id: studentId },\n      data: {\n        medal: data.medal,\n        grade: data.grade,\n        assignedByTeacher: { connect: { id: teacherId } },\n        academicAssignedAt: new Date(),\n      },\n    });\n  }\n\n  private getRandomAvatar(): string {\n    const styles = ['fun-emoji', 'bottts', 'pixel-art', 'adventurer', 'notionists'];\n    const randomStyle = styles[Math.floor(Math.random() * styles.length)];\n    const randomSeed = crypto.randomBytes(8).toString('hex');\n    return `https://api.dicebear.com/7.x/${randomStyle}/svg?seed=${randomSeed}`;\n  }\n\n  async create(data: Prisma.UserCreateInput): Promise<User> {\n    const profileImage = data.profileImage || this.getRandomAvatar();\n    return this.prisma.user.create({\n      data: {\n        ...data,\n        profileImage,\n      },\n    });\n  }\n\n  async resetProfileImage(id: string): Promise<User | null> {\n    const randomAvatar = this.getRandomAvatar();\n    return this.prisma.user.update({\n      where: { id },\n      data: { profileImage: randomAvatar },\n    });\n  }\n\n  async update(id: string, data: Prisma.UserUpdateInput): Promise<User | null> {\n    return this.prisma.user.update({\n      where: { id },\n      data,\n      include: {\n        assignedByTeacher: { select: { name: true } },\n        parentOf: {\n          include: {\n            student: {\n              select: {\n                id: true,\n                name: true,\n                email: true,\n                grade: true,\n                medal: true,\n                profileSlug: true,\n              },\n            },\n          },\n        },\n        parentRequests: {\n          orderBy: { createdAt: 'desc' },\n        },\n      },\n    });\n  }\n\n  // Parent Portal Methods\n\n  async createParentRequest(parentId: string, studentEmail: string) {\n    // Check if already linked\n    const student = await this.prisma.user.findUnique({ where: { email: studentEmail } });\n    if (student) {\n      const existingLink = await this.prisma.parentStudent.findUnique({\n        where: { parentId_studentId: { parentId, studentId: student.id } }\n      });\n      if (existingLink) throw new Error('Student is already linked to your account');\n    }\n\n    // Check for pending request\n    const existingRequest = await this.prisma.parentRequest.findFirst({\n      where: {\n        parentId,\n        studentEmail,\n        status: 'PENDING',\n      },\n    });\n\n    if (existingRequest) {\n      throw new Error('A pending request already exists for this student');\n    }\n\n    return this.prisma.parentRequest.create({\n      data: {\n        parentId,\n        studentEmail,\n        status: 'PENDING',\n      },\n    });\n  }\n\n  async getPendingRequests() {\n    return this.prisma.parentRequest.findMany({\n      where: { status: 'PENDING' },\n      include: { parent: { select: { id: true, name: true, email: true } } },\n      orderBy: { createdAt: 'desc' },\n    });\n  }\n\n  async approveRequest(requestId: string) {\n    const request = await this.prisma.parentRequest.findUnique({\n      where: { id: requestId },\n      include: { parent: true },\n    });\n\n    if (!request) throw new Error('Request not found');\n\n    // Find student by email\n    const student = await this.prisma.user.findUnique({\n      where: { email: request.studentEmail },\n    });\n\n    if (!student) throw new Error('Student not found');\n\n    // Create link\n    await this.prisma.parentStudent.create({\n      data: {\n        parentId: request.parentId,\n        studentId: student.id,\n      },\n    });\n\n    // Update request\n    await this.prisma.parentRequest.update({\n      where: { id: requestId },\n      data: { status: 'APPROVED' },\n    });\n\n    // Notify Student\n    await this.notificationsService.create(\n      student.id,\n      'Parent Linked',\n      `${request.parent.name} has been linked as your parent. If this is incorrect, please report to admin.`,\n      'ALERT',\n    );\n\n    return { success: true };\n  }\n\n  async rejectRequest(requestId: string) {\n    return this.prisma.parentRequest.update({\n      where: { id: requestId },\n      data: { status: 'REJECTED' },\n    });\n  }\n\n  async manualLinkParentStudent(parentId: string, studentEmail: string) {\n    const student = await this.prisma.user.findUnique({\n      where: { email: studentEmail },\n    });\n    const parent = await this.prisma.user.findUnique({\n      where: { id: parentId },\n    });\n\n    if (!student || !parent) throw new Error('User not found');\n\n    // Create link\n    await this.prisma.parentStudent.create({\n      data: { parentId, studentId: student.id },\n    });\n\n    // Notify Student\n    await this.notificationsService.create(\n      student.id,\n      'Parent Linked',\n      `${parent.name} has been linked as your parent by Admin. If this is incorrect, please report.`,\n      'ALERT',\n    );\n    // Notify Parent\n    await this.notificationsService.create(\n      parent.id,\n      'Student Linked',\n      `You have been linked to student ${student.name} by Admin.`,\n      'INFO',\n    );\n\n    return { success: true };\n  }\n\n  async getStudentData(parentId: string, studentId: string) {\n    // Verify parent-student link\n    const link = await this.prisma.parentStudent.findUnique({\n      where: { parentId_studentId: { parentId, studentId } },\n    });\n\n    if (!link) {\n      throw new Error('Not authorized to view this student data');\n    }\n\n    return this.prisma.user.findUnique({\n      where: { id: studentId },\n      include: {\n        enrollments: { include: { course: true } },\n        assignedCourses: { include: { course: true } },\n        practiceTestResults: {\n          include: { test: true },\n          take: 20,\n          orderBy: { createdAt: 'desc' },\n        },\n        loginHistory: {\n          take: 10,\n          orderBy: { loginTime: 'desc' },\n        },\n        assignedByTeacher: { select: { name: true, email: true } },\n      },\n    });\n  }\n\n  async findAllTeachers() {\n    return this.prisma.user.findMany({\n      where: { role: 'TEACHER' },\n      select: {\n        id: true,\n        name: true,\n        email: true,\n        role: true,\n      },\n    });\n  }\n\n  async findAllParents() {\n    return this.prisma.user.findMany({\n      where: { role: 'PARENT' },\n      select: {\n        id: true,\n        name: true,\n        email: true,\n        role: true,\n        parentOf: {\n          include: {\n            student: {\n              select: { name: true }\n            }\n          }\n        }\n      },\n    });\n  }\n}\n"],"names":["UsersService","findOne","email","user","prisma","findUnique","where","include","assignedByTeacher","select","name","parentOf","student","id","grade","medal","profileSlug","studentOf","parent","parentRequests","orderBy","createdAt","profileSettings","updateData","crypto","randomUUID","showMedals","showGrades","showCourses","showTestResults","update","data","findById","enrollments","course","title","thumbnail","practiceTestResults","test","findAllStudents","findMany","role","academicAssignedAt","_count","updateAcademicStatus","studentId","teacherId","connect","Date","getRandomAvatar","styles","randomStyle","Math","floor","random","length","randomSeed","randomBytes","toString","create","profileImage","resetProfileImage","randomAvatar","createParentRequest","parentId","studentEmail","existingLink","parentStudent","parentId_studentId","Error","existingRequest","parentRequest","findFirst","status","getPendingRequests","approveRequest","requestId","request","notificationsService","success","rejectRequest","manualLinkParentStudent","getStudentData","link","assignedCourses","take","loginHistory","loginTime","findAllTeachers","findAllParents"],"mappings":"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"}