{"version":3,"sources":["../../src/chat/chat.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Body,\n  Param,\n  UseGuards,\n  Request,\n} from '@nestjs/common';\nimport { ChatService } from './chat.service';\nimport { JwtAuthGuard } from '../auth/jwt-auth.guard';\nimport { ApiTags, ApiOperation, ApiBearerAuth } from '@nestjs/swagger';\n\ninterface RequestWithUser {\n  user: {\n    userId?: string;\n    id?: string;\n    sub?: string;\n    role?: string;\n  };\n}\n\n@ApiTags('Chat')\n@ApiBearerAuth()\n@UseGuards(JwtAuthGuard)\n@Controller('chat')\nexport class ChatController {\n  constructor(private readonly chatService: ChatService) {}\n\n  @Get('messages/:contactId')\n  @ApiOperation({ summary: 'Get messages between two users' })\n  async getMessages(\n    @Request() req: RequestWithUser,\n    @Param('contactId') contactId: string,\n  ) {\n    const userId = req.user.userId || req.user.id || req.user.sub || '';\n    return this.chatService.getMessages(userId, contactId);\n  }\n\n  @Get('contacts')\n  @ApiOperation({ summary: 'Get list of active chat contacts' })\n  async getChatList(@Request() req: RequestWithUser) {\n    const userId = req.user.userId || req.user.id || req.user.sub || '';\n    return this.chatService.getChatList(userId);\n  }\n\n  @Get('requests')\n  @ApiOperation({ summary: 'Get pending message requests (Teachers only)' })\n  async getPendingRequests(@Request() req: RequestWithUser) {\n    const userId = req.user.userId || req.user.id || req.user.sub || '';\n    return this.chatService.getPendingRequests(userId);\n  }\n\n  @Get('sent-requests')\n  @ApiOperation({ summary: 'Get sent message requests' })\n  async getSentRequests(@Request() req: RequestWithUser) {\n    const userId = req.user.userId || req.user.id || req.user.sub || '';\n    return this.chatService.getSentRequests(userId);\n  }\n\n  @Post('request/:id/handle')\n  @ApiOperation({ summary: 'Approve or Reject a message request' })\n  async handleRequest(\n    @Param('id') requestId: string,\n    @Body() body: { status: 'APPROVED' | 'REJECTED' },\n  ) {\n    return this.chatService.handleRequest(requestId, body.status);\n  }\n}\n"],"names":["ChatController","getMessages","req","contactId","userId","user","id","sub","chatService","getChatList","getPendingRequests","getSentRequests","handleRequest","requestId","body","status","summary"],"mappings":";;;;+BA0BaA;;;eAAAA;;;wBAlBN;6BACqB;8BACC;yBACwB;;;;;;;;;;;;;;;AAe9C,IAAA,AAAMA,iBAAN,MAAMA;IAGX,MAEMC,YACJ,AAAWC,GAAoB,EAC/B,AAAoBC,SAAiB,EACrC;QACA,MAAMC,SAASF,IAAIG,IAAI,CAACD,MAAM,IAAIF,IAAIG,IAAI,CAACC,EAAE,IAAIJ,IAAIG,IAAI,CAACE,GAAG,IAAI;QACjE,OAAO,IAAI,CAACC,WAAW,CAACP,WAAW,CAACG,QAAQD;IAC9C;IAEA,MAEMM,YAAY,AAAWP,GAAoB,EAAE;QACjD,MAAME,SAASF,IAAIG,IAAI,CAACD,MAAM,IAAIF,IAAIG,IAAI,CAACC,EAAE,IAAIJ,IAAIG,IAAI,CAACE,GAAG,IAAI;QACjE,OAAO,IAAI,CAACC,WAAW,CAACC,WAAW,CAACL;IACtC;IAEA,MAEMM,mBAAmB,AAAWR,GAAoB,EAAE;QACxD,MAAME,SAASF,IAAIG,IAAI,CAACD,MAAM,IAAIF,IAAIG,IAAI,CAACC,EAAE,IAAIJ,IAAIG,IAAI,CAACE,GAAG,IAAI;QACjE,OAAO,IAAI,CAACC,WAAW,CAACE,kBAAkB,CAACN;IAC7C;IAEA,MAEMO,gBAAgB,AAAWT,GAAoB,EAAE;QACrD,MAAME,SAASF,IAAIG,IAAI,CAACD,MAAM,IAAIF,IAAIG,IAAI,CAACC,EAAE,IAAIJ,IAAIG,IAAI,CAACE,GAAG,IAAI;QACjE,OAAO,IAAI,CAACC,WAAW,CAACG,eAAe,CAACP;IAC1C;IAEA,MAEMQ,cACJ,AAAaC,SAAiB,EAC9B,AAAQC,IAAyC,EACjD;QACA,OAAO,IAAI,CAACN,WAAW,CAACI,aAAa,CAACC,WAAWC,KAAKC,MAAM;IAC9D;IAxCA,YAAY,AAAiBP,WAAwB,CAAE;aAA1BA,cAAAA;IAA2B;AAyC1D;;;;QAtCkBQ,SAAS;;;;;;;;;;;;;;QAUTA,SAAS;;;;;;;;;;;;QAOTA,SAAS;;;;;;;;;;;;QAOTA,SAAS;;;;;;;;;;;;QAOTA,SAAS"}