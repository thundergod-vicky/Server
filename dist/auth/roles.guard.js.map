{"version":3,"sources":["../../src/auth/roles.guard.ts"],"sourcesContent":["import { Injectable, CanActivate, ExecutionContext } from '@nestjs/common';\nimport { Reflector } from '@nestjs/core';\nimport { Role } from '@prisma/client';\nimport { ROLES_KEY } from './roles.decorator';\n\n@Injectable()\nexport class RolesGuard implements CanActivate {\n  constructor(private reflector: Reflector) {}\n\n  canActivate(context: ExecutionContext): boolean {\n    const requiredRoles = this.reflector.getAllAndOverride<Role[]>(ROLES_KEY, [\n      context.getHandler(),\n      context.getClass(),\n    ]);\n    if (!requiredRoles) {\n      return true;\n    }\n    const { user } = context.switchToHttp().getRequest();\n    return requiredRoles.some((role) => user.role === role);\n  }\n}\n"],"names":["RolesGuard","canActivate","context","requiredRoles","reflector","getAllAndOverride","ROLES_KEY","getHandler","getClass","user","switchToHttp","getRequest","some","role"],"mappings":";;;;+BAMaA;;;eAAAA;;;wBAN6C;sBAChC;gCAEA;;;;;;;;;;AAGnB,IAAA,AAAMA,aAAN,MAAMA;IAGXC,YAAYC,OAAyB,EAAW;QAC9C,MAAMC,gBAAgB,IAAI,CAACC,SAAS,CAACC,iBAAiB,CAASC,yBAAS,EAAE;YACxEJ,QAAQK,UAAU;YAClBL,QAAQM,QAAQ;SACjB;QACD,IAAI,CAACL,eAAe;YAClB,OAAO;QACT;QACA,MAAM,EAAEM,IAAI,EAAE,GAAGP,QAAQQ,YAAY,GAAGC,UAAU;QAClD,OAAOR,cAAcS,IAAI,CAAC,CAACC,OAASJ,KAAKI,IAAI,KAAKA;IACpD;IAZA,YAAY,AAAQT,SAAoB,CAAE;aAAtBA,YAAAA;IAAuB;AAa7C"}