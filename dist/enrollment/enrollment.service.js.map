{"version":3,"sources":["../../src/enrollment/enrollment.service.ts"],"sourcesContent":["import {\n  Injectable,\n  BadRequestException,\n  NotFoundException,\n} from '@nestjs/common';\nimport { PrismaService } from '../prisma/prisma.service';\n\n@Injectable()\nexport class EnrollmentService {\n  constructor(private prisma: PrismaService) {}\n\n  async enroll(studentId: string, courseId: string) {\n    // Check if already enrolled\n    const existing = await this.prisma.enrollment.findUnique({\n      where: {\n        studentId_courseId: {\n          studentId,\n          courseId,\n        },\n      },\n    });\n\n    if (existing) {\n      throw new BadRequestException('Already enrolled in this course');\n    }\n\n    return this.prisma.enrollment.create({\n      data: {\n        studentId,\n        courseId,\n      },\n      include: {\n        course: true,\n      },\n    });\n  }\n\n  async withdraw(studentId: string, courseId: string) {\n    return this.prisma.enrollment.delete({\n      where: {\n        studentId_courseId: {\n          studentId,\n          courseId,\n        },\n      },\n    });\n  }\n\n  async getMyCourses(studentId: string) {\n    return this.prisma.enrollment.findMany({\n      where: {\n        studentId,\n      },\n      include: {\n        course: {\n          include: {\n            teacher: {\n              select: {\n                name: true,\n              },\n            },\n            _count: {\n              select: { chapters: true },\n            },\n          },\n        },\n      },\n    });\n  }\n\n  async checkEnrollment(studentId: string, courseId: string) {\n    const enrollment = await this.prisma.enrollment.findUnique({\n      where: {\n        studentId_courseId: {\n          studentId,\n          courseId,\n        },\n      },\n    });\n    return { enrolled: !!enrollment };\n  }\n}\n"],"names":["EnrollmentService","enroll","studentId","courseId","existing","prisma","enrollment","findUnique","where","studentId_courseId","BadRequestException","create","data","include","course","withdraw","delete","getMyCourses","findMany","teacher","select","name","_count","chapters","checkEnrollment","enrolled"],"mappings":";;;;+BAQaA;;;eAAAA;;;wBAJN;+BACuB;;;;;;;;;;AAGvB,IAAA,AAAMA,oBAAN,MAAMA;IAGX,MAAMC,OAAOC,SAAiB,EAAEC,QAAgB,EAAE;QAChD,4BAA4B;QAC5B,MAAMC,WAAW,MAAM,IAAI,CAACC,MAAM,CAACC,UAAU,CAACC,UAAU,CAAC;YACvDC,OAAO;gBACLC,oBAAoB;oBAClBP;oBACAC;gBACF;YACF;QACF;QAEA,IAAIC,UAAU;YACZ,MAAM,IAAIM,2BAAmB,CAAC;QAChC;QAEA,OAAO,IAAI,CAACL,MAAM,CAACC,UAAU,CAACK,MAAM,CAAC;YACnCC,MAAM;gBACJV;gBACAC;YACF;YACAU,SAAS;gBACPC,QAAQ;YACV;QACF;IACF;IAEA,MAAMC,SAASb,SAAiB,EAAEC,QAAgB,EAAE;QAClD,OAAO,IAAI,CAACE,MAAM,CAACC,UAAU,CAACU,MAAM,CAAC;YACnCR,OAAO;gBACLC,oBAAoB;oBAClBP;oBACAC;gBACF;YACF;QACF;IACF;IAEA,MAAMc,aAAaf,SAAiB,EAAE;QACpC,OAAO,IAAI,CAACG,MAAM,CAACC,UAAU,CAACY,QAAQ,CAAC;YACrCV,OAAO;gBACLN;YACF;YACAW,SAAS;gBACPC,QAAQ;oBACND,SAAS;wBACPM,SAAS;4BACPC,QAAQ;gCACNC,MAAM;4BACR;wBACF;wBACAC,QAAQ;4BACNF,QAAQ;gCAAEG,UAAU;4BAAK;wBAC3B;oBACF;gBACF;YACF;QACF;IACF;IAEA,MAAMC,gBAAgBtB,SAAiB,EAAEC,QAAgB,EAAE;QACzD,MAAMG,aAAa,MAAM,IAAI,CAACD,MAAM,CAACC,UAAU,CAACC,UAAU,CAAC;YACzDC,OAAO;gBACLC,oBAAoB;oBAClBP;oBACAC;gBACF;YACF;QACF;QACA,OAAO;YAAEsB,UAAU,CAAC,CAACnB;QAAW;IAClC;IAvEA,YAAY,AAAQD,MAAqB,CAAE;aAAvBA,SAAAA;IAAwB;AAwE9C"}