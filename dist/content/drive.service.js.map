{"version":3,"sources":["../../src/content/drive.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { google } from 'googleapis';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { Readable } from 'stream';\n\n@Injectable()\nexport class DriveService {\n  private drive;\n  private folderId = process.env.GOOGLE_DRIVE_FOLDER_ID;\n\n  constructor() {\n    const keyPath = path.join(process.cwd(), 'google-credentials.json');\n    if (fs.existsSync(keyPath)) {\n      const auth = new google.auth.GoogleAuth({\n        keyFile: keyPath,\n        scopes: ['https://www.googleapis.com/auth/drive'],\n      });\n      this.drive = google.drive({ version: 'v3', auth });\n    } else {\n      console.error('google-credentials.json not found!');\n    }\n  }\n\n  async uploadFile(\n    file: Express.Multer.File,\n  ): Promise<{ id: string; webViewLink: string; mimeType: string }> {\n    if (!this.drive) throw new Error('Drive not initialized');\n\n    const media = {\n      mimeType: file.mimetype,\n      body: Readable.from(file.buffer),\n    };\n\n    const response = await this.drive.files.create({\n      requestBody: {\n        name: file.originalname,\n        parents: [this.folderId],\n      },\n      media: media,\n      fields: 'id, webViewLink, mimeType',\n    });\n\n    return response.data;\n  }\n\n  async getFileStream(fileId: string): Promise<Readable> {\n    if (!this.drive) throw new Error('Drive not initialized');\n    const response = await this.drive.files.get(\n      { fileId, alt: 'media' },\n      { responseType: 'stream' },\n    );\n    return response.data;\n  }\n\n  async getFileMetadata(fileId: string) {\n    if (!this.drive) throw new Error('Drive not initialized');\n    const response = await this.drive.files.get({\n      fileId,\n      fields: 'id, name, mimeType, size',\n    });\n    return response.data;\n  }\n}\n"],"names":["DriveService","uploadFile","file","drive","Error","media","mimeType","mimetype","body","Readable","from","buffer","response","files","create","requestBody","name","originalname","parents","folderId","fields","data","getFileStream","fileId","get","alt","responseType","getFileMetadata","process","env","GOOGLE_DRIVE_FOLDER_ID","keyPath","path","join","cwd","fs","existsSync","auth","google","GoogleAuth","keyFile","scopes","version","console","error"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPc;4BACJ;4DACH;8DACE;wBACG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGlB,IAAA,AAAMA,eAAN,MAAMA;IAiBX,MAAMC,WACJC,IAAyB,EACuC;QAChE,IAAI,CAAC,IAAI,CAACC,KAAK,EAAE,MAAM,IAAIC,MAAM;QAEjC,MAAMC,QAAQ;YACZC,UAAUJ,KAAKK,QAAQ;YACvBC,MAAMC,gBAAQ,CAACC,IAAI,CAACR,KAAKS,MAAM;QACjC;QAEA,MAAMC,WAAW,MAAM,IAAI,CAACT,KAAK,CAACU,KAAK,CAACC,MAAM,CAAC;YAC7CC,aAAa;gBACXC,MAAMd,KAAKe,YAAY;gBACvBC,SAAS;oBAAC,IAAI,CAACC,QAAQ;iBAAC;YAC1B;YACAd,OAAOA;YACPe,QAAQ;QACV;QAEA,OAAOR,SAASS,IAAI;IACtB;IAEA,MAAMC,cAAcC,MAAc,EAAqB;QACrD,IAAI,CAAC,IAAI,CAACpB,KAAK,EAAE,MAAM,IAAIC,MAAM;QACjC,MAAMQ,WAAW,MAAM,IAAI,CAACT,KAAK,CAACU,KAAK,CAACW,GAAG,CACzC;YAAED;YAAQE,KAAK;QAAQ,GACvB;YAAEC,cAAc;QAAS;QAE3B,OAAOd,SAASS,IAAI;IACtB;IAEA,MAAMM,gBAAgBJ,MAAc,EAAE;QACpC,IAAI,CAAC,IAAI,CAACpB,KAAK,EAAE,MAAM,IAAIC,MAAM;QACjC,MAAMQ,WAAW,MAAM,IAAI,CAACT,KAAK,CAACU,KAAK,CAACW,GAAG,CAAC;YAC1CD;YACAH,QAAQ;QACV;QACA,OAAOR,SAASS,IAAI;IACtB;IAnDA,aAAc;aAFNF,WAAWS,QAAQC,GAAG,CAACC,sBAAsB;QAGnD,MAAMC,UAAUC,MAAKC,IAAI,CAACL,QAAQM,GAAG,IAAI;QACzC,IAAIC,IAAGC,UAAU,CAACL,UAAU;YAC1B,MAAMM,OAAO,IAAIC,kBAAM,CAACD,IAAI,CAACE,UAAU,CAAC;gBACtCC,SAAST;gBACTU,QAAQ;oBAAC;iBAAwC;YACnD;YACA,IAAI,CAACtC,KAAK,GAAGmC,kBAAM,CAACnC,KAAK,CAAC;gBAAEuC,SAAS;gBAAML;YAAK;QAClD,OAAO;YACLM,QAAQC,KAAK,CAAC;QAChB;IACF;AAyCF"}