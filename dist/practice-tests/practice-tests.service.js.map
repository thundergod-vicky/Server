{"version":3,"sources":["../../src/practice-tests/practice-tests.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { PrismaService } from '../prisma/prisma.service';\nimport { CreatePracticeTestDto } from './dto/create-practice-test.dto';\n\n@Injectable()\nexport class PracticeTestsService {\n  constructor(private prisma: PrismaService) {}\n\n  async create(teacherId: string, dto: CreatePracticeTestDto) {\n    return await this.prisma.practiceTest.create({\n      data: {\n        title: dto.title,\n        totalQuestions: dto.totalQuestions,\n        questions: dto.questions,\n        timeLimit: dto.timeLimit,\n        teacherId: teacherId,\n      },\n    });\n  }\n\n  async findAllByTeacher(teacherId: string) {\n    return await this.prisma.practiceTest.findMany({\n      where: { teacherId },\n      orderBy: { createdAt: 'desc' },\n    });\n  }\n\n  async findOne(id: string) {\n    return await this.prisma.practiceTest.findUnique({\n      where: { id },\n    });\n  }\n\n  async findAll() {\n    return await this.prisma.practiceTest.findMany({\n      include: { teacher: { select: { name: true } } },\n      orderBy: { createdAt: 'desc' },\n    });\n  }\n\n  async update(id: string, teacherId: string, dto: CreatePracticeTestDto) {\n    return await this.prisma.practiceTest.update({\n      where: { id, teacherId },\n      data: {\n        title: dto.title,\n        totalQuestions: dto.totalQuestions,\n        questions: dto.questions,\n        timeLimit: dto.timeLimit,\n      },\n    });\n  }\n\n  async remove(id: string, teacherId: string) {\n    return await this.prisma.practiceTest.delete({\n      where: { id, teacherId },\n    });\n  }\n\n  async submitResult(\n    studentId: string,\n    testId: string,\n    data: {\n      score: number;\n      total: number;\n      timeTaken: number;\n      status: 'COMPLETED' | 'CHEATED';\n      answers: any;\n    },\n  ) {\n    // Basic rating calculation: (score / total) * 5\n    const baseRating = (data.score / data.total) * 5;\n\n    // Bonus for speed (very basic implementation for now)\n    // If student finished in less than 50% of the time, add a small boost\n    const test = await this.prisma.practiceTest.findUnique({\n      where: { id: testId },\n    });\n    let finalRating = baseRating;\n    if (test?.timeLimit && data.timeTaken < (test.timeLimit * 60) / 2) {\n      finalRating = Math.min(5, finalRating + 0.5);\n    }\n\n    return await this.prisma.practiceTestResult.create({\n      data: {\n        studentId,\n        testId,\n        score: data.score,\n        total: data.total,\n        timeTaken: data.timeTaken,\n        status: data.status,\n        rating: parseFloat(finalRating.toFixed(1)),\n        answers: data.answers,\n      },\n    });\n  }\n\n  async findResultsByStudent(studentId: string) {\n    return await this.prisma.practiceTestResult.findMany({\n      where: { studentId },\n      include: { test: { select: { title: true, totalQuestions: true } } },\n      orderBy: { createdAt: 'desc' },\n    });\n  }\n\n  async findResultByStudentAndTest(studentId: string, testId: string) {\n    return await this.prisma.practiceTestResult.findFirst({\n      where: { studentId, testId },\n    });\n  }\n}\n"],"names":["PracticeTestsService","create","teacherId","dto","prisma","practiceTest","data","title","totalQuestions","questions","timeLimit","findAllByTeacher","findMany","where","orderBy","createdAt","findOne","id","findUnique","findAll","include","teacher","select","name","update","remove","delete","submitResult","studentId","testId","baseRating","score","total","test","finalRating","timeTaken","Math","min","practiceTestResult","status","rating","parseFloat","toFixed","answers","findResultsByStudent","findResultByStudentAndTest","findFirst"],"mappings":"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"}