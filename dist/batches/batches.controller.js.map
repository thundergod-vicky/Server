{"version":3,"sources":["../../src/batches/batches.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Body,\n  Param,\n  Delete,\n  UseGuards,\n  Request,\n  ForbiddenException,\n  Patch,\n} from '@nestjs/common';\nimport { ApiTags, ApiOperation, ApiBearerAuth } from '@nestjs/swagger';\nimport { BatchesService } from './batches.service';\nimport { CreateBatchDto } from './dto/create-batch.dto';\nimport { AssignStudentsDto } from './dto/assign-students.dto';\nimport { JwtAuthGuard } from '../auth/jwt-auth.guard';\n\n@ApiTags('Batches')\n@ApiBearerAuth()\n@Controller('batches')\n@UseGuards(JwtAuthGuard)\nexport class BatchesController {\n  constructor(private readonly batchesService: BatchesService) {}\n\n  private checkAdmin(req: any) {\n    const user = req.user as { role: string };\n    if (user.role !== 'ADMIN') {\n      throw new ForbiddenException('Only admins can perform this action');\n    }\n  }\n\n  @Post()\n  @ApiOperation({ summary: 'Create a new batch (Admin only)' })\n  create(@Body() createBatchDto: CreateBatchDto, @Request() req) {\n    this.checkAdmin(req);\n    return this.batchesService.create(createBatchDto);\n  }\n\n  @Get()\n  @ApiOperation({ summary: 'Get all batches (Admin only)' })\n  findAll(@Request() req) {\n    this.checkAdmin(req);\n    return this.batchesService.findAll();\n  }\n\n  @Get('my-batches')\n  @ApiOperation({ summary: 'Get batches for the current student or teacher' })\n  findMyBatches(@Request() req: any) {\n    const user = req.user as { userId: string; role: string };\n    if (user.role === 'STUDENT') {\n      return this.batchesService.findByStudent(user.userId);\n    } else if (user.role === 'TEACHER') {\n      return this.batchesService.findByTeacher(user.userId);\n    }\n    throw new ForbiddenException('Not applicable for this role');\n  }\n\n  @Get(':id')\n  @ApiOperation({ summary: 'Get batch details' })\n  findOne(@Param('id') id: string) {\n    return this.batchesService.findOne(id);\n  }\n\n  @Patch(':id/students')\n  @ApiOperation({ summary: 'Assign students to a batch (Admin only)' })\n  assignStudents(\n    @Param('id') id: string,\n    @Body() assignStudentsDto: AssignStudentsDto,\n    @Request() req,\n  ) {\n    this.checkAdmin(req);\n    return this.batchesService.assignStudents(id, assignStudentsDto.studentIds);\n  }\n\n  @Patch(':id/teacher')\n  @ApiOperation({ summary: 'Assign a teacher to a batch (Admin only)' })\n  assignTeacher(\n    @Param('id') id: string,\n    @Body() data: { teacherId: string },\n    @Request() req,\n  ) {\n    this.checkAdmin(req);\n    return this.batchesService.assignTeacher(id, data.teacherId);\n  }\n\n  @Delete(':id/students/:studentId')\n  @ApiOperation({ summary: 'Remove a student from a batch (Admin only)' })\n  removeStudent(\n    @Param('id') id: string,\n    @Param('studentId') studentId: string,\n    @Request() req,\n  ) {\n    this.checkAdmin(req);\n    return this.batchesService.removeStudent(id, studentId);\n  }\n\n  @Delete(':id')\n  @ApiOperation({ summary: 'Delete a batch (Admin only)' })\n  remove(@Param('id') id: string, @Request() req) {\n    this.checkAdmin(req);\n    return this.batchesService.delete(id);\n  }\n}\n"],"names":["BatchesController","checkAdmin","req","user","role","ForbiddenException","create","createBatchDto","batchesService","findAll","findMyBatches","findByStudent","userId","findByTeacher","findOne","id","assignStudents","assignStudentsDto","studentIds","assignTeacher","data","teacherId","removeStudent","studentId","remove","delete","summary"],"mappings":";;;;+BAsBaA;;;eAAAA;;;wBAXN;yBAC8C;gCACtB;gCACA;mCACG;8BACL;;;;;;;;;;;;;;;AAMtB,IAAA,AAAMA,oBAAN,MAAMA;IAGHC,WAAWC,GAAQ,EAAE;QAC3B,MAAMC,OAAOD,IAAIC,IAAI;QACrB,IAAIA,KAAKC,IAAI,KAAK,SAAS;YACzB,MAAM,IAAIC,0BAAkB,CAAC;QAC/B;IACF;IAIAC,OAAO,AAAQC,cAA8B,EAAE,AAAWL,GAAG,EAAE;QAC7D,IAAI,CAACD,UAAU,CAACC;QAChB,OAAO,IAAI,CAACM,cAAc,CAACF,MAAM,CAACC;IACpC;IAIAE,QAAQ,AAAWP,GAAG,EAAE;QACtB,IAAI,CAACD,UAAU,CAACC;QAChB,OAAO,IAAI,CAACM,cAAc,CAACC,OAAO;IACpC;IAIAC,cAAc,AAAWR,GAAQ,EAAE;QACjC,MAAMC,OAAOD,IAAIC,IAAI;QACrB,IAAIA,KAAKC,IAAI,KAAK,WAAW;YAC3B,OAAO,IAAI,CAACI,cAAc,CAACG,aAAa,CAACR,KAAKS,MAAM;QACtD,OAAO,IAAIT,KAAKC,IAAI,KAAK,WAAW;YAClC,OAAO,IAAI,CAACI,cAAc,CAACK,aAAa,CAACV,KAAKS,MAAM;QACtD;QACA,MAAM,IAAIP,0BAAkB,CAAC;IAC/B;IAIAS,QAAQ,AAAaC,EAAU,EAAE;QAC/B,OAAO,IAAI,CAACP,cAAc,CAACM,OAAO,CAACC;IACrC;IAIAC,eACE,AAAaD,EAAU,EACvB,AAAQE,iBAAoC,EAC5C,AAAWf,GAAG,EACd;QACA,IAAI,CAACD,UAAU,CAACC;QAChB,OAAO,IAAI,CAACM,cAAc,CAACQ,cAAc,CAACD,IAAIE,kBAAkBC,UAAU;IAC5E;IAIAC,cACE,AAAaJ,EAAU,EACvB,AAAQK,IAA2B,EACnC,AAAWlB,GAAG,EACd;QACA,IAAI,CAACD,UAAU,CAACC;QAChB,OAAO,IAAI,CAACM,cAAc,CAACW,aAAa,CAACJ,IAAIK,KAAKC,SAAS;IAC7D;IAIAC,cACE,AAAaP,EAAU,EACvB,AAAoBQ,SAAiB,EACrC,AAAWrB,GAAG,EACd;QACA,IAAI,CAACD,UAAU,CAACC;QAChB,OAAO,IAAI,CAACM,cAAc,CAACc,aAAa,CAACP,IAAIQ;IAC/C;IAIAC,OAAO,AAAaT,EAAU,EAAE,AAAWb,GAAG,EAAE;QAC9C,IAAI,CAACD,UAAU,CAACC;QAChB,OAAO,IAAI,CAACM,cAAc,CAACiB,MAAM,CAACV;IACpC;IA/EA,YAAY,AAAiBP,cAA8B,CAAE;aAAhCA,iBAAAA;IAAiC;AAgFhE;;;;QAtEkBkB,SAAS;;;;;;;;;;;;;;QAOTA,SAAS;;;;;;;;;;;;QAOTA,SAAS;;;;;;;;;;;;QAYTA,SAAS;;;;;;;;;;;;QAMTA,SAAS;;;;;;;;;;;;;;;;QAWTA,SAAS;;;;;;;;;;;;;;;;QAWTA,SAAS;;;;;;;;;;;;;;;;QAWTA,SAAS"}