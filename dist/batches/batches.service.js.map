{"version":3,"sources":["../../src/batches/batches.service.ts"],"sourcesContent":["import { Injectable, NotFoundException } from '@nestjs/common';\nimport { PrismaService } from '../prisma/prisma.service';\nimport { CreateBatchDto } from './dto/create-batch.dto';\n\n@Injectable()\nexport class BatchesService {\n  constructor(private prisma: PrismaService) {}\n\n  async create(createBatchDto: CreateBatchDto) {\n    return this.prisma.batch.create({\n      data: {\n        name: createBatchDto.name,\n        description: createBatchDto.description,\n        teacherId: createBatchDto.teacherId,\n      },\n      include: {\n        teacher: { select: { id: true, name: true, email: true } },\n      },\n    });\n  }\n\n  async findAll() {\n    return this.prisma.batch.findMany({\n      include: {\n        teacher: { select: { id: true, name: true, email: true } },\n        _count: { select: { students: true } },\n      },\n    });\n  }\n\n  async findOne(id: string) {\n    const batch = await this.prisma.batch.findUnique({\n      where: { id },\n      include: {\n        teacher: { select: { id: true, name: true, email: true } },\n        students: { select: { id: true, name: true, email: true } },\n      },\n    });\n\n    if (!batch) {\n      throw new NotFoundException(`Batch with ID ${id} not found`);\n    }\n\n    return batch;\n  }\n\n  async assignStudents(batchId: string, studentIds: string[]) {\n    return this.prisma.batch.update({\n      where: { id: batchId },\n      data: {\n        students: {\n          connect: studentIds.map((id) => ({ id })),\n        },\n      },\n      include: {\n        students: { select: { id: true, name: true, email: true } },\n      },\n    });\n  }\n\n  async assignTeacher(batchId: string, teacherId: string) {\n    return this.prisma.batch.update({\n      where: { id: batchId },\n      data: {\n        teacherId: teacherId,\n      },\n      include: {\n        teacher: { select: { id: true, name: true, email: true } },\n      },\n    });\n  }\n\n  async removeStudent(batchId: string, studentId: string) {\n    return this.prisma.batch.update({\n      where: { id: batchId },\n      data: {\n        students: {\n          disconnect: { id: studentId },\n        },\n      },\n    });\n  }\n\n  async findByStudent(studentId: string) {\n    return this.prisma.batch.findMany({\n      where: {\n        students: {\n          some: { id: studentId },\n        },\n      },\n      include: {\n        teacher: { select: { id: true, name: true, email: true } },\n      },\n    });\n  }\n\n  async findByTeacher(teacherId: string) {\n    return this.prisma.batch.findMany({\n      where: { teacherId },\n      include: {\n        _count: { select: { students: true } },\n      },\n    });\n  }\n\n  async delete(id: string) {\n    return this.prisma.batch.delete({\n      where: { id },\n    });\n  }\n}\n"],"names":["BatchesService","create","createBatchDto","prisma","batch","data","name","description","teacherId","include","teacher","select","id","email","findAll","findMany","_count","students","findOne","findUnique","where","NotFoundException","assignStudents","batchId","studentIds","update","connect","map","assignTeacher","removeStudent","studentId","disconnect","findByStudent","some","findByTeacher","delete"],"mappings":"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"}